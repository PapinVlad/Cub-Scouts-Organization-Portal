### Obanshire Cubs Backend

Backend server application for the Obanshire Cub Scouts website.

## Prerequisites

Before you begin, ensure you have the following installed:

- [Node.js](https://nodejs.org/) (v14.x or higher recommended)
- npm (comes with Node.js) or [Yarn](https://yarnpkg.com/)
- Database: Either [MySQL](https://www.mysql.com/) (v8.0+) 


## Installation

Follow these steps to set up the project locally:

1. Clone the repository:

```shellscript
git clone [repository-url]
cd obanshire-cubs-backend
```


2. Install dependencies:

```shellscript
npm install
# or if you use Yarn
yarn install
```


3. Create a `.env` file in the root directory with the following variables:

```plaintext
# Server Configuration
PORT=5000
NODE_ENV=development

# Database Configuration
DB_TYPE=mysql  # or postgres
DB_HOST=localhost
DB_PORT=3306  # 3306 for MySQL
DB_NAME=obanshire_cubs
DB_USER=your_username
DB_PASSWORD=your_password

# JWT Configuration
JWT_SECRET=your_jwt_secret_key
JWT_EXPIRES_IN=24h

# File Upload Configuration
UPLOAD_DIR=uploads
MAX_FILE_SIZE=5242880  # 5MB in bytes
```


4. Create the database:

For MySQL:

```sql
CREATE DATABASE obanshire_cubs;
```






## Running the Application

### Development Mode

To start the development server with auto-restart on file changes:

```shellscript
npm run dev
# or
yarn dev
```

This will run the server on the port specified in your `.env` file (default: 5000).

### Production Mode

To start the server in production mode:

```shellscript
npm start
# or
yarn start
```

## Database Setup

The application uses Sequelize ORM which will automatically create the tables based on the defined models when the server starts. However, you may want to run migrations and seeders for a more controlled setup:

1. If you have Sequelize CLI installed globally:

```shellscript
sequelize db:migrate
sequelize db:seed:all
```


2. Or using npx:

```shellscript
npx sequelize-cli db:migrate
npx sequelize-cli db:seed:all
```




## Project Structure

```plaintext
/
├── config/             # Configuration files
│   ├── database.js     # Database configuration
│   └── ...
├── controllers/        # Request handlers
├── middleware/         # Express middleware
│   ├── auth.js         # Authentication middleware
│   └── ...
├── models/             # Sequelize models
├── routes/             # API routes
├── uploads/            # Uploaded files (created at runtime)
├── utils/              # Utility functions
├── .env                # Environment variables (create this)
├── server.js           # Application entry point
└── ...
```

## API Endpoints

The backend provides the following main API endpoints:

### Authentication

- `POST /api/auth/register` - Register a new user
- `POST /api/auth/login` - Login and get JWT token
- `GET /api/auth/user` - Get current user info


### Users

- `GET /api/users` - Get all users (admin only)
- `GET /api/users/:id` - Get user by ID
- `PUT /api/users/:id` - Update user
- `DELETE /api/users/:id` - Delete user (admin only)


### Badges

- `GET /api/badges` - Get all badges
- `POST /api/badges` - Create a new badge (admin/leader only)
- `GET /api/badges/:id` - Get badge by ID
- `PUT /api/badges/:id` - Update badge (admin/leader only)
- `DELETE /api/badges/:id` - Delete badge (admin/leader only)


### Events

- `GET /api/events` - Get all events
- `POST /api/events` - Create a new event (admin/leader only)
- `GET /api/events/:id` - Get event by ID
- `PUT /api/events/:id` - Update event (admin/leader only)
- `DELETE /api/events/:id` - Delete event (admin/leader only)


### Photos

- `GET /api/photos` - Get all photos
- `POST /api/photos` - Upload a new photo
- `GET /api/photos/:id` - Get photo by ID
- `DELETE /api/photos/:id` - Delete photo (owner/admin only)


### Announcements

- `GET /api/announcements` - Get all announcements
- `POST /api/announcements` - Create a new announcement (admin/leader only)
- `GET /api/announcements/:id` - Get announcement by ID
- `PUT /api/announcements/:id` - Update announcement (admin/leader only)
- `DELETE /api/announcements/:id` - Delete announcement (admin/leader only)


## File Uploads

The application uses Multer for handling file uploads. Uploaded files are stored in the `uploads` directory by default. Image files are processed using Sharp for resizing and optimization.

## Authentication

The application uses JWT (JSON Web Tokens) for authentication. Protected routes require a valid JWT token to be included in the Authorization header:

```plaintext
Authorization: Bearer <your_jwt_token>
```

## Error Handling

The API returns standard HTTP status codes:

- 200: Success
- 201: Created
- 400: Bad Request
- 401: Unauthorized
- 403: Forbidden
- 404: Not Found
- 500: Server Error


Error responses follow this format:

```json
{
  "message": "Error message description"
}
```

## Troubleshooting

If you encounter issues:

1. Check if the database server is running
2. Verify your `.env` file has the correct database credentials
3. Check the server logs for specific error messages
4. Make sure all dependencies are installed correctly
5. Ensure you have the correct permissions for the database user


## Additional Information

For more details about the API endpoints, request/response formats, and authentication, please refer to the API documentation.